$schema: "http://json-schema.org/draft-07/schema#"
$title: "Protocol"
type: object

allOf:
  - $ref: "./common.schema.yaml#/$defs/FAIRCommon"

required:
  - title
  - family
  - version
  - recipes

properties:
  recordType:
    type: string
    description: "Record discriminator. Should be 'protocol'."
  state:
    type: string
    description: "Workflow state identifier (e.g., draft, approved)."
  recordId:
    type: string
    description: "Stable filesystem identifier generated from naming rules."

  family:
    type: string
    description: "Stable identifier for this conceptual protocol (e.g., 'agarose_gel')."

  version:
    type: string
    description: "Semantic version string (e.g., 1.0.0)."

  status:
    type: string
    enum: ["draft", "active", "deprecated"]
    default: "draft"
    description: "High-level publication status for this protocol version."

  tags:
    type: array
    items:
      type: string
    description: "Free-form tags for search/grouping."

  supersedes:
    type: string
    description: "@id of the protocol version superseded by this record (if any)."

  recipes:
    type: array
    minItems: 1
    description: >
      References to recipe records that this protocol orchestrates (e.g., gel mix, running buffer).
    items:
      type: object
      required:
        - role
        - recipeId
      additionalProperties: false
      properties:
        id:
          type: string
          description: "Local identifier within this protocol (e.g., 'gel_mix')."
        role:
          type: string
          description: "Semantic role of this recipe in the protocol."
          enum:
            - gel_mix
            - running_buffer
            - sample_prep
            - master_mix
            - cleanup_buffer
            - other
        recipeId:
          type: string
          description: "Record id (@id) of the recipe to use."
        recipeVersion:
          type: string
          description: "Optional specific recipe version label."
        scaleParameter:
          type: string
          description: "Optional name of a protocol parameter that scales this recipe (e.g., 'num_gels')."

  executionSteps:
    type: array
    description: "Instructions for executing the protocol once recipes have been prepared."
    items:
      type: string

  parametersSchema:
    type: object
    description: >
      JSON Schema shape for runtime parameters supplied when executing this protocol.
      Runs should validate protocol_parameters against this schema if provided.
    additionalProperties: true

  labwareRoles:
    type: object
    description: >
      Named labware placeholders referenced by protocol events (e.g., cell_plate, media_reservoir).
    additionalProperties:
      $ref: "./datatypes/labware-role.schema.yaml"

  events:
    type: array
    description: "Ordered list of event templates executed when this protocol runs."
    items:
      $ref: "./datatypes/protocol-event.schema.yaml"

additionalProperties: false
