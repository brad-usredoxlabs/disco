$schema: "http://json-schema.org/draft-07/schema#"
$id: "https://computable-lab.com/schema/computable-lab/protocol.schema.yaml"
$title: "Protocol"
type: object

allOf:
  - $ref: "./common.schema.yaml#/$defs/FAIRCommon"

required:
  - title
  - family
  - version
  - labwareRoles
  - events

properties:
  kind:
    type: string
    description: "Record discriminator. Should be 'protocol'."
    const: "protocol"
  state:
    type: string
    description: "Workflow state identifier (e.g., draft, approved)."
  recordId:
    type: string
    description: "Stable filesystem identifier generated from naming rules."

  family:
    type: string
    description: "Stable identifier for this conceptual protocol (e.g., 'agarose_gel')."

  version:
    type: string
    description: "Semantic version string (e.g., 1.0.0)."

  status:
    type: string
    enum: ["in_progress", "finalized", "deprecated"]
    description: "High-level publication status for this protocol version."

  tags:
    type: array
    items:
      type: string
    description: "Free-form tags for search/grouping."

  supersedes:
    type: string
    description: "@id of the protocol version superseded by this record (if any)."

  parametersSchema:
    type: object
    description: >
      JSON Schema shape for runtime parameters supplied when executing this protocol.
      Runs should validate protocol_parameters against this schema if provided.
    additionalProperties: true

  labwareRoles:
    type: object
    description: >
      Named labware placeholders referenced by protocol events (e.g., cell_plate, media_reservoir).
    additionalProperties:
      $ref: "./datatypes/labware-role.schema.yaml"

  events:
    type: array
    description: "Ordered list of event templates executed when this protocol runs."
    items:
      $ref: "./datatypes/protocol-event.schema.yaml"

  assertions:
    type: array
    description: "Embedded assertions or references to standalone assertion records."
    items:
      oneOf:
        - $ref: "./assertion.schema.yaml"
        - $ref: "./datatypes/assertion-ref.schema.yaml"

additionalProperties: false
