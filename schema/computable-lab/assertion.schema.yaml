$schema: "http://json-schema.org/draft-07/schema#"
$id: "assertion.schema.yaml"
title: Assertion
description: >
  An Assertion is a declarative claim about biology, experiment design,
  execution, measurement, or interpretation.
  Assertions may be scoped, evidentiary, opinionated, and time-bound.
  They are append-only and form a knowledge graph when aggregated.

type: object
required:
  - "@id"
  - kind
  - subject
  - predicate
  - object
  - provenance

properties:
  "@id":
    type: string
    description: "Globally unique identifier for this assertion."

  kind:
    type: string
    const: "assertion"

  # -------------------------
  # Core triple
  # -------------------------
  subject:
    $ref: "#/definitions/entity_ref"

  predicate:
    type: string
    description: >
      The relationship being asserted (e.g. increases, measures, is_control_for).
      Should come from a controlled vocabulary (e.g. disco:increases).

  object:
    type: object
    description: >
      The object of the assertion.
      Often a feature, target, role, or biological phenomenon.
    required: ["type", "ref"]
    properties:
      type:
        type: string
        enum:
          - feature
          - target
          - intent
          - role
          - phenomenon
          - hypothesis
          - assertion
          - material
          - acquisition
          - experiment
          - project
      ref:
        type: string
        description: "Identifier of the object entity."
      qualifiers:
        type: object
        description: "Optional object-level qualifiers (e.g. compartment, direction)."
        additionalProperties: true
    additionalProperties: false

  # -------------------------
  # Optional qualifiers
  # -------------------------
  qualifiers:
    type: object
    description: >
      Additional context that refines the assertion
      (e.g. feature, target, compartment, direction, modality).
    properties:
      feature:
        type: string
        description: "Feature the assertion is about (if not the primary object)."
      target:
        type: string
        description: "Optional biological target (gene, protein, compartment, pathway)."
      direction:
        type: string
        enum: [increase, decrease, no_change, unknown]
      modality:
        type: string
        description: "Measurement modality or proxy (e.g. CellROX, qPCR, GC-FID)."
      notes:
        type: string
    additionalProperties: true

  # -------------------------
  # Scope (where this is true)
  # -------------------------
  scope:
    type: object
    description: >
      Context in which this assertion applies.
      Absence of scope implies global or general belief.
    properties:
      study:
        type: string
      experiment:
        type: string
      run:
        type: string
      plate:
        type: string
      well:
        type: string
      acquisition:
        type: string
      channel:
        type: string
      biological_context:
        type: object
        description: "Optional biological constraints (organism, cell line, compartment)."
        additionalProperties: true
    additionalProperties: false

  # -------------------------
  # Provenance & belief
  # -------------------------
  provenance:
    type: object
    description: "Who asserted this, when, and why."
    required: ["asserted_by", "asserted_at"]
    properties:
      asserted_by:
        type: string
        description: "Agent asserting this claim (person, AI, pipeline)."
      asserted_at:
        type: string
        format: date-time
      confidence:
        type: number
        minimum: 0
        maximum: 1
        description: "Degree of belief held by the asserter (0â€“1)."
      epistemic_status:
        type: string
        enum:
          - belief
          - hypothesis
          - observation
          - inference
          - literature_claim
          - consensus
      evidence:
        type: array
        description: "Evidence supporting this assertion."
        items:
          $ref: "#/definitions/evidence"
      notes:
        type: string
    additionalProperties: false

additionalProperties: false

definitions:
  # -------------------------
  # Generic entity reference
  # -------------------------
  entity_ref:
    type: object
    description: >
      Reference to an entity that the assertion is about.
    required: ["type", "ref"]
    properties:
      type:
        type: string
        enum:
          - well
          - run
          - experiment
          - study
          - material
          - acquisition
          - channel
          - feature
          - target
          - assertion
      ref:
        type: string
    additionalProperties: false

  # -------------------------
  # Evidence block
  # -------------------------
  evidence:
    type: object
    description: "Evidence item supporting or motivating the assertion."
    required: ["kind", "ref"]
    properties:
      kind:
        type: string
        enum:
          - publication
          - dataset
          - protocol
          - observation
          - analysis
          - notebook
      ref:
        type: string
        description: "DOI, URI, file ref, or record ID."
      excerpt:
        type: string
        description: "Optional quoted or summarized evidence."
    additionalProperties: false
