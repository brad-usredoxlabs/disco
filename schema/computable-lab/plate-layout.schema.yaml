$schema: "http://json-schema.org/draft-07/schema#"
$id: "https://computable-lab.com/schema/computable-lab/plate-layout.schema.yaml"
$title: "Plate Layout"
type: object

allOf:
  - $ref: "./common.schema.yaml#/$defs/FAIRCommon"

required:
  - runId
  - layout

properties:
  kind:
    type: string
    description: "Record discriminator. Should be 'plateLayout'."
    const: "plateLayout"
  state:
    type: string
    description: "Workflow state identifier (e.g., draft, approved)."
  recordId:
    type: string
    description: "Stable filesystem identifier generated from naming rules."

  runId:
    type: string
    description: "Identifier/path of the parent Run this layout belongs to."

  title:
    type: string
    description: "Optional label for this plate layout or plate position."

  description:
    type: string
    description: "Narrative description of the layout or assay intent."

  editorSpecId:
    type: string
    description: "Identifier of the PlateEditorSpec used to render/edit this layout."
    default: "spec:fire:v1"

  layout:
    type: object
    description: "Describes the physical layout rendered by the editor."
    default:
      kind: "plate96"
      wellKeying: "A01"
    required:
      - kind
    properties:
      kind:
        type: string
        description: "Layout preset (plate96, plate384, tubeset, tube, etc.)."
        enum: ["plate96", "plate384", "tubeset", "tube"]
      wellKeying:
        type: string
        description: "Formatting hint for well ids (A01, R1C1, T01)."
        enum: ["A01", "R1C1", "T01"]
      label:
        type: string
        description: "Optional human-readable name for the layout preset."
      dimensions:
        type: object
        description: "Optional custom row/column counts for non-standard layouts."
        properties:
          rows:
            type: integer
            minimum: 1
          columns:
            type: integer
            minimum: 1

  materials:
    type: array
    description: "Optional palette/library entries shown in the editor."
    items:
      $ref: "./datatypes/material-ref.schema.yaml"

  wells:
    type: object
    description: "Dictionary of wells/tubes keyed by formatted id (e.g., A01, T05)."
    additionalProperties:
      $ref: "#/$defs/Well"

  events:
    type: array
    description: "Optional sequence of plate events applied to this layout."
    items:
      $ref: "./datatypes/plate-event.schema.yaml"

  assertions:
    type: array
    description: "Embedded assertions or references to standalone assertion records."
    items:
      oneOf:
        - $ref: "./assertion.schema.yaml"
        - $ref: "./datatypes/assertion-ref.schema.yaml"

  annotations:
    type: object
    description: "Free-form metadata keyed by well, role, or instrument tag."
    additionalProperties: true

$defs:
  Well:
    type: object
    description: "Per-well content and annotations."
    properties:
      label:
        type: string
      notes:
        type: string
      inputs:
        type: array
        description: "Materials present in this well (sample, treatment, dyes, etc.)."
        items:
          $ref: "#/$defs/MaterialUse"
      measurements:
        type: array
        description: "Optional per-well measurement references."
        items:
          $ref: "#/$defs/MeasurementRef"
    additionalProperties: false

  MaterialUse:
    $ref: "./datatypes/material-use.schema.yaml"

  Amount:
    type: object
    properties:
      value:
        type: number
      unit:
        type: string
      type:
        type: string
        description: "Optional descriptor (volume, mass, concentration)."
    additionalProperties: false

  MeasurementRef:
    type: object
    description: "Reference to measurement outputs for the well."
    properties:
      label:
        type: string
      channel:
        type: string
      file:
        type: string
      dataRef:
        type: string
    additionalProperties: false
