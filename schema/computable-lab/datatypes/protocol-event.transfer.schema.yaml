$schema: "http://json-schema.org/draft-07/schema#"
$id: "protocol-event.transfer.schema.yaml"

title: ProtocolEventTransferDetails
type: object
description: "Template for a transfer (aspirate + dispense) step."

required:
  - type
  - source_role
  - target_role
  - volume

properties:
  type:
    type: string
    const: "transfer"

  source_role:
    type: string
    description: "Labware role providing the source liquid."

  target_role:
    type: string
    description: "Labware role receiving the transfer."

  mapping:
    type: array
    description: "Per-well mapping between source and target roles."
    minItems: 1
    items:
      type: object
      required:
        - source_well
        - target_well
      additionalProperties: false
      properties:
        source_well:
          type: string
          description: "Source well (e.g., A1)."
        target_well:
          type: string
          description: "Target well (e.g., B3)."
        pattern:
          type: string
          description: "Optional description of how this mapping was generated."

  mapping_spec:
    type: object
    description: >
      Declarative mapping spec (identity/fill/broadcast) used when explicit mapping
      is not provided. Editors can resolve this into a concrete mapping.
    properties:
      mode:
        type: string
        enum: ["fill", "identity", "broadcast"]
        description: "fill = source[i] -> target[i]; identity = source[i] -> target[i] with equal counts; broadcast = source[0] -> all targets."
      source_wells:
        type: array
        items:
          type: string
      target_wells:
        type: array
        items:
          type: string
    additionalProperties: false

  volume:
    type: string
    description: "Literal or parameterized volume (e.g., '100 uL' or '${seed_volume}')."

  material:
    $ref: "./material-ref.schema.yaml"

  pipetting_hint:
    type: object
    description: "Optional adapter hint."
    additionalProperties: false
    properties:
      mode:
        type: string
        enum: ["single", "multi", "custom"]
      channels:
        type: integer
        minimum: 1
      pattern:
        type: string
        description: "High-level pattern (row, column, checkerboard, etc.)."

  notes:
    type: string

allOf:
  - oneOf:
      - required: ["mapping"]
      - required: ["mapping_spec"]

additionalProperties: false
