$schema: "http://json-schema.org/draft-07/schema#"
$id: "material-library-entry.schema.yaml"
title: MaterialLibraryEntry
type: object
additionalProperties: false
required: [id, label, category, experimental_intents]

properties:
  id:
    type: string
    description: "Canonical local material identifier."
    pattern: "^material:[a-z0-9_]+$"

  label:
    type: string
    minLength: 1

  category:
    type: string
    enum: [reagent, medium, solvent, buffer, additive, waste, other, compound, dye, cell_line, media]

  experimental_intents:
    type: array
    minItems: 1
    items:
      type: string
      enum: [sample, treatment, assay_material, control, other]

  tags:
    type: array
    minItems: 0
    items:
      type: string
      minLength: 1

  synonyms:
    type: array
    items: { type: string }

  classified_as:
    type: array
    description: "Optional biological classifications (taxon, cell line, etc.)."
    items:
      type: object
      additionalProperties: false
      required: [id, label, domain, source]
      properties:
        id: { type: string }
        label: { type: string }
        domain:
          type: string
          enum: [taxon, cell_line, tissue]
        source:
          type: string
          enum: [NCBITaxon, CL, UBERON, local]

  measures:
    type: array
    description: "Optional feature IDs measured/indicated by this material (e.g., dyes)."
    items:
      type: string
      pattern: "^feature:[a-z0-9_]+$"

  detection:
    type: object
    additionalProperties: false
    properties:
      modality:
        type: string
        enum: [fluorescence, absorbance, luminescence, microscopy, ms, qpcr, other]
      channel_hint:
        type: string
      excitation_nm:
        type: number
      emission_nm:
        type: number

  mechanism:
    type: object
    additionalProperties: false
    required: [type, targets]
    properties:
      type:
        type: string
        enum: [agonist, antagonist, activator, inhibitor, inducer, suppressor, uncoupler, stabilizer, modulator, other]
      targets:
        type: array
        items:
          type: object
          additionalProperties: false
          required: [id, label]
          properties:
            id: { type: string }
            label: { type: string }
  affected_process:
    type: object
    additionalProperties: false
    required: [id, label]
    properties:
      id: { type: string }
      label: { type: string }

  control_role:
    type: string
    enum: [positive, negative, vehicle]

  control_for:
    type: object
    additionalProperties: false
    properties:
      features:
        type: array
        items:
          type: string
          pattern: "^feature:[a-z0-9_]+$"
      acquisition_modalities:
        type: array
        items:
          type: string
          enum: [fluorescence, absorbance, luminescence, microscopy, ms, qpcr, other]
      notes:
        type: string

  xref:
    type: object
    description: "Optional ontology/vendor cross-references; not used as canonical IDs."
    additionalProperties:
      type: string
  vendor_slug:
    type: string
    description: "Optional vendor slug (thermo, sigmaaldrich, biorad, thomas, internal, unknown)."
    enum: [thermo, sigmaaldrich, biorad, thomas, internal, unknown]
  catalog_numbers:
    type: array
    description: "Optional vendor catalog numbers (supports multiple pack sizes)."
    items:
      type: string
      minLength: 1

  defaults:
    type: object
    additionalProperties: false
    properties:
      role: { type: string }
      amount:
        $ref: "#/definitions/Amount"

definitions:
  Amount:
    type: object
    additionalProperties: false
    required: [value, unit]
    properties:
      value: { type: number }
      unit: { type: string, minLength: 1 }
