$schema: "http://json-schema.org/draft-07/schema#"
$id: "plate-event.schema.yaml"

title: PlateEvent
type: object
description: >
  Semantic event that affects plate layout or observes plate state.
  Plate layout derives from initial labware contents plus the time-ordered sequence of PlateEvents.

required:
  - id
  - event_type
  - details

properties:
  id:
    type: string
    description: "Stable event identifier (unique within the run)."

  event_type:
    type: string
    enum:
      - transfer
      - add_material
      - incubate
      - read
      - wash
      - harvest
      - sample_operation
      - other

  # Planned time offset (required for planned events; use timestamp_actual for executed time)
  t_offset:
    type: string
    description: "ISO-8601 duration from run start (e.g., 'PT0S', 'PT5M') for planned timeline."

  # Actual timestamp when executed (optional; replaces deprecated timestamp)
  timestamp:
    type: string
    format: date-time
    description: "Deprecated: use timestamp_actual. Historically the actual execution time."

  timestamp_actual:
    type: string
    format: date-time
    description: "Actual execution timestamp (if available)."

  labware:
    type: array
    description: "Labware ids this event touches."
    minItems: 1
    items:
      type: string

  details:
    description: "Event-type-specific payload."
    oneOf:
      - $ref: "./plate-event.transfer.schema.yaml"
      - $ref: "./plate-event.add-material.schema.yaml"
      - $ref: "./plate-event.incubate.schema.yaml"
      - $ref: "./plate-event.read.schema.yaml"
      - $ref: "./plate-event.wash.schema.yaml"
      - $ref: "./plate-event.harvest.schema.yaml"
      - $ref: "./plate-event.sample-operation.schema.yaml"
      - $ref: "./plate-event.other.schema.yaml"

anyOf:
  - required: ["timestamp"]
  - required: ["timestamp_actual"]
  - required: ["t_offset"]

additionalProperties: false
