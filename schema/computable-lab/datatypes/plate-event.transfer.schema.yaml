$schema: "http://json-schema.org/draft-07/schema#"
$id: "plate-event.transfer.schema.yaml"

title: PlateEventTransferDetails
type: object
description: "Details for a transfer (aspirate + dispense) event."

required:
  - type
  - source_labware
  - target_labware
  - volume

properties:
  type:
    type: string
    const: "transfer"

  source_labware:
    type: string
    description: "Source labware id."

  target_labware:
    type: string
    description: "Target labware id."

  mapping:
    type: array
    description: "Canonical source -> target mapping used for replay."
    minItems: 1
    items:
      type: object
      required:
        - source_well
        - target_well
      additionalProperties: false
      properties:
        source_well:
          type: string
        target_well:
          type: string
        role:
          type: string
        volume:
          type: object
          required: [value, unit]
          properties:
            value:
              type: number
            unit:
              type: string
          additionalProperties: false

  mapping_spec:
    type: object
    description: >
      Optional authoring hint used to regenerate mapping. If both are present, mapping is canonical.
    additionalProperties: true

  volume:
    type: object
    description: "Volume to transfer (structured)."
    required:
      - value
      - unit
    properties:
      value:
        type: number
      unit:
        type: string
    additionalProperties: false

  material_id:
    type: string
    description: "Optional explicit material identifier if not derived from source."

  pipetting_hint:
    type: object
    description: "Optional robot hint; never required for correctness."
    properties:
      mode:
        type: string
        enum: ["single", "multi"]
      channels:
        type: integer
        minimum: 1
        description: "Suggested number of channels."
      pattern:
        type: string
        description: "High-level pattern, e.g. 'column', 'row', 'block'."
    additionalProperties: false

additionalProperties: false
