id: protocolWorkflow
initial: draft
meta:
  label: Protocol workflow
states:
  draft:
    meta:
      description: Draft editing allowed
    on:
      SUBMIT:
        target: review
        guard: validation.passed
  review:
    meta:
      description: Awaiting review
    on:
      REQUEST_CHANGES:
        target: draft
      APPROVE:
        target: approved
        guard: signoff.atLeastOne
  approved:
    meta:
      description: Approved protocols are immutable
      immutable: true
    on:
      REOPEN:
        target: draft
